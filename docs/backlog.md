# 改善案バックログ

目的: 仕様・ドキュメント更新のための待機所。実装はここでは行わない。

## Must
優先度理由: ユーザー報告の不具合でリリース品質に直結し、再現性が高いもの。

| 項目 | 種別 | spec.md 反映先候補 | 受け入れ条件のヒント |
| --- | --- | --- | --- |
| 可読版 `dist/index.html` だけレイアウトが崩れる | build | 実装制約（ビルド/パッケージ管理） / 配布物の仕様 | `dist/index.html` / `dist/index.min.html` を開いたときに主要UIの配置が一致する。再現手順（`pnpm run build:single` → `dist/index.html` を `file://` で開く）を明記し、差分が出た場合は DOM 構造/主要クラスの検証方針（DOMテスト or 画面検証）を定義する。 |
| 複数ファイル読み込み時の行番号が不安定（2始まり/連番化など） | bug | 10.3 複数ファイル読み込み / 行番号 | 複数回の追加読み込みでも各ファイルが必ず 1..N で採番される。再現ケースがあれば記録し、修正後に再現しない。 |

## Should
優先度理由: 体験改善や視認性向上だが、Mustの不具合修正後に着手できる範囲。

| 項目 | 種別 | spec.md 反映先候補 | 受け入れ条件のヒント |
| --- | --- | --- | --- |
| アンカーが増えると表示領域が狭くなるため折りたたみUI | request | 4.2 操作 / アンカー行仕様 | アンカーパネルを折りたため、表示領域の確保ができる。 |
| 左右ペイン別クリア | request | 4.2 操作 | 左のみ/右のみのクリアができ、他方は保持される。 |
| 「ファイルを選択」UIを各ペイン右側に配置 | request | 4.1 レイアウト / 10.1 UI仕様 | 左右それぞれ独立して操作でき、ヘッダ/ツールバーの縦幅が増えない（増える場合は仕様に明記）。 |
| 「ここにファイルをドロップ」UIを廃止し、ペイン全面ドロップにする | request | 4.1 レイアウト / 10.1 UI仕様 | ペイン内のどこにドロップしても読み込める。ドロップ可能状態の視覚フィードバックを定義する。 |
| 複数ファイル間の余白を見やすくする（論理行番号は維持） | request | 10.3 連結ルール / 行番号定義 | 表示上は十分な空白があり、表示行番号と元ファイルの論理行番号が混同されない。差分計算やアンカー指定の行番号がズレない。 |
| アンカー行番号表示を file-local にする | bug | 8. アンカー行仕様 / 10.3 行番号 | アンカー表示が「ファイル単位の行番号」を示し、全体連番にならない。 |
| ファイルごとに行番号やアンカーが視認しやすいスタイル | request | 8. アンカー行仕様 / UI仕様 | どのファイルの行か UI 上で分かる（色/バッジ/区切り等）。既存アンカー機能と衝突しない。 |

## Later
優先度理由: 実装コストが高く、既存体験の安定化後に検討。

| 項目 | 種別 | spec.md 反映先候補 | 受け入れ条件のヒント |
| --- | --- | --- | --- |
| LocalStorageで状態保存・復元 | request | UI仕様 / 非機能要件 | リロード後に前回の内容・UI状態が復元される。 |

## Done
| 項目 | 種別 | spec.md 反映先候補 | 受け入れ条件のヒント |
| --- | --- | --- | --- |
| 外部依存を彷彿させる文字列をリリースに残さない（置換ではなく削除） | build | 3.2 配布物に「特定文字列」を残さない | `dist/index.html` / `dist/index.min.html` に API/GitHub 等を連想する文字列が含まれない。置換ではなくビルド段階で除去する。 |
| polyfill関数をリリースに残さない（build.modulePreloadをオフ） | build | 実装制約（ビルド/パッケージ管理） | `dist/index.html` / `dist/index.min.html` から modulepreload polyfill が消える。 |
| 最適化index.htmlと読みやすいindex.htmlを分けて出力 | build | 実装制約（ビルド/パッケージ管理） | `dist/` に minify版と可読版が同時に出力される。 |
| 対応行判定ロジックのブラッシュアップ | request | 5.2.1 replace の作り方 | 行のペアリングが不自然なケースを減らし、同一入力で安定した対応が得られる。 |
| ファイル構成を確認できる STRUCTURE.md を新規作成 | docs | ドキュメント方針 | 主要ディレクトリと役割が一覧化される。 |

注記: 「複数ファイルの行番号再カウント」は Done から再オープンし、Must の不安定化バグとして扱う。
