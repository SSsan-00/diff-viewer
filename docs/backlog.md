# 改善案バックログ

目的: 仕様・ドキュメント更新のための待機所。実装はここでは行わない。

## Must
優先度理由: ユーザー報告の不具合でリリース品質に直結し、再現性が高いもの。

| 項目 | 種別 | spec.md 反映先候補 | 受け入れ条件のヒント |
| --- | --- | --- | --- |
| 可読版 `dist/index.html` のレイアウト崩れ | build | 13.2 ビルド成果物の種類 / 12.1.2 配布物受け入れ条件 | `dist/index.html` と `dist/index.min.html` を `file://` 直開きで比較し、主要UIの配置・スタイルが一致する。スタイル整形が原因なら `format-readable.mjs` を無効化する方針も検討する（提案）。 |
| `自動` で EUC-JP が文字化けする | bug | 10.4 混在文字コードの読み込み / 12.1.1 受け入れ条件 | エンコーディング `自動` で EUC-JP ファイルを読み込み、例: `日本語テキスト` が文字化けしない。 |
| ファイル読み込み時に `cannot access 'p8' before initialization` が出る | bug | 10.1 UI仕様 / 10.4 混在文字コード | ファイル読み込み時にコンソール/画面へ上記エラーが出ない。再現手順（対象ファイル名/操作）を記録し、修正後に再現しない。 |

## Should
優先度理由: 体験改善や視認性向上だが、Mustの不具合修正後に着手できる範囲。

| 項目 | 種別 | spec.md 反映先候補 | 受け入れ条件のヒント |
| --- | --- | --- | --- |
| 文字コード変更時に再解釈（再デコード）する | request | 10.4.2 文字コード選択の扱い | 読み込み後に文字コードを変更すると、同じ入力（元バイト列）を指定エンコーディングで再デコードして表示が更新される。再読み込みを強制しない。 |
| アンカーパネルの折りたたみUIをトグルボタンにする | request | 4.2 操作 / 8. アンカー行仕様 | 折りたたみ状態がボタンの見た目/`aria-pressed` 等で明確に分かる。キーボード操作でも切替可能。 |
| Ctrl+F をフォーカス中のペイン検索にする | request | 4.2 操作 | 左/右エディタのどちらにフォーカスがあるかで検索対象が切り替わる。ブラウザ標準の検索ではなく Monaco の検索UIが開く。 |
| アンカー解除時の丸マーカーが残る | bug | 8. アンカー行仕様 / 4.2 操作 | 片側だけアンカーを設定した状態で同じ行を再クリックすると丸マーカーが消える。両側アンカーの解除時は左右両方の丸が消える。 |
| 対応行検出の追加ケース（PHP/C# 定数） | request | 5.2 行レベル差分 | `define('FOO','foo');` と `public readonly string FOO = 'foo';` が同じブロック/同一表示行に揃う。近似語の誤マッチは避ける。 |

## Later
優先度理由: 実装コストが高く、既存体験の安定化後に検討。

| 項目 | 種別 | spec.md 反映先候補 | 受け入れ条件のヒント |
| --- | --- | --- | --- |
| 現時点では該当なし | - | - | - |

## Done
| 項目 | 種別 | spec.md 反映先候補 | 受け入れ条件のヒント |
| --- | --- | --- | --- |
| 左右ペイン別クリア | request | 4.2 操作 | 左のみ/右のみのクリアができ、他方は保持される。 |
| LocalStorageで状態保存・復元 | request | UI仕様 / 非機能要件 | リロード後に前回の内容・UI状態が復元される。 |
| ファイル構成を確認できる STRUCTURE.md を新規作成 | docs | ドキュメント方針 | 主要ディレクトリと役割が一覧化される。 |
| アンカーが増えると表示領域が狭くなるため折りたたみUI | request | 4.2 操作 / アンカー行仕様 | アンカーパネルを折りたため、表示領域の確保ができる。 |
| 「ファイルを選択」UIを各ペイン左側に配置 | request | 4.1 レイアウト / 10.1 UI仕様 | 左右それぞれ独立して操作でき、ヘッダ/ツールバーの縦幅が増えない。 |
| 「ここにファイルをドロップ」UIを廃止し、ペイン全面ドロップにする | request | 4.1 レイアウト / 10.1 UI仕様 | ペイン内のどこにドロップしても読み込める。ドロップ可能状態の視覚フィードバックを定義する。 |
| 複数ファイル間の余白を見やすくする（論理行番号は維持） | request | 10.3 連結ルール / 行番号定義 | 表示上は十分な空白があり、表示行番号と元ファイルの論理行番号が混同されない。差分計算やアンカー指定の行番号がズレない。 |
| 複数ファイル読み込み時の行番号が不安定（2始まり/連番化など） | bug | 10.3 複数ファイル読み込み / 行番号 | 複数回の追加読み込みでも各ファイルが必ず 1..N で採番される。 |
| アンカー行番号表示を file-local にする | bug | 8. アンカー行仕様 / 10.3 行番号 | アンカー表示が「ファイル単位の行番号」を示し、全体連番にならない。 |
| ファイルごとに行番号やアンカーが視認しやすいスタイル | request | 8. アンカー行仕様 / UI仕様 | どのファイルの行か UI 上で分かる（色/バッジ/区切り等）。既存アンカー機能と衝突しない。 |
| ペイン間のファイル数差で対応行の表示がズレる | bug | 5.2 行レベル差分 / 10.3.4 ファイル境界の表示 | 左に2ファイル・右に1ファイルの読み込みでも、差分の行揃えがファイル境界の余白分だけズレない。viewZone 等の表示余白は対応行の縦位置に影響しない。 |
| 配布物に `http` / `github` 系文字列が残る | build | 3.2 配布物に「特定文字列」を残さない / 13.3 リリース手順 | `dist/index.html` / `dist/index.min.html` に `http://` / `https://` / `github` / `api` / `github.com` 等が **一切含まれない**（`<script>` / `<style>` を含む検査）。発生源（Monaco codicons）を除去してビルド段階で混入させない。 |

注記: 「複数ファイルの行番号再カウント」は不安定化バグとして再オープンしたが、修正済み。
